{
    "title": "MedAide: Leveraging Large Language Models for On-Premise Medical Assistance on Edge Devices",
    "abstract": "Large language models (LLMs) are revolutionizing various domains with their remarkable natural language processing (NLP) abilities. However, deploying LLMs in resource-constrained edge computing and embedded systems presents significant challenges. Another challenge lies in delivering medical assistance in remote areas with limited healthcare facilities and infrastructure. To address this, we introduce MedAide, an on-premise healthcare chatbot. It leverages tiny-LLMs integrated with LangChain, providing efficient edge-based preliminary medical diagnostics and support. MedAide employs model optimizations for minimal memory footprint and latency on embedded edge devices without server infrastructure. The training process is optimized using low-rank adaptation (LoRA). Additionally, the model is trained on diverse medical datasets, employing reinforcement learning from human feedback (RLHF) to enhance its domain-specific capabilities. The system is implemented on various consumer GPUs and Nvidia Jetson development board. MedAide achieves 77% accuracy in medical consultations and scores 56 in USMLE benchmark, enabling an energy-efficient healthcare assistance platform that alleviates privacy concerns due to edge-based deployment, thereby empowering the community.",
    "sections": [
        {
            "section_id": "1",
            "parent_section_id": null,
            "section_name": "1. Introduction",
            "text": "In recent years, large language models (LLMs) (Zhao2023,  ###reference_b1###) have emerged as a groundbreaking technology with the potential to revolutionize multiple domains, and are exceedingly gaining research interest. State-of-the-art LLMs, such as GPT-3 (Brown2020,  ###reference_b2###) and its successor GPT-4 (Bubeck2023,  ###reference_b3###) have revolutionized NLP tasks. Other LLMs are used for various generative tasks like robotics and smart homes/cities. These auto-regressive models learn the statistical patterns and semantic structures of human language. With their vast knowledge base, LLMs can generate coherent and contextually relevant text and understand complex queries. This prowess makes them a valuable resource for a wide range of applications including medicine and autonomous cognitive systems (10.3389/frai.2023.1169595,  ###reference_b4###)(jeblick2022chatgpt,  ###reference_b5###) and serve as a driving force behind our research.\nLanguage and interaction are fundamental elements in medicine, enabling healthcare professionals to gather comprehensive insights (Franz2018,  ###reference_b6###), developing a deeper understanding of the individual’s health status. Navigating the landscape of medical applications, there is a compelling need for remote assistance as highlighted in Figure 1. A World Bank and WHO report (who,  ###reference_b7###) states that half of the world’s population lacks essential health services, with healthcare costs pushing 100 million into extreme poverty annually. This underscores the urgent need for universal health coverage.\n###figure_1### Moreover, the deployment of LLMs on resource-constrained devices while minimizing latency presents a significant challenge, see Figure 2. State-of-the-art LLMs (Brown2020,  ###reference_b2###) (Bubeck2023,  ###reference_b3###) (yin2023survey,  ###reference_b9###) heavily rely on server-based deployment, limiting accessibility, and require significant power consumption and computational resources (Zhao2023,  ###reference_b1###).\n###figure_2### ###figure_3### The selection of LLM for edge deployment depends on network parameters, performance metrics, open-source availability, and hardware constraints. We utilized the open-LLM leader-board (Open-LLM-Leaderboard-Report-2023,  ###reference_b10###), which serves as a valuable platform for comprehensive analysis of LLMs. An analysis was conducted to identify suitable LLMs, and among them, LLaMa2-7B(touvron2023llama,  ###reference_b15###) emerged as the standout choice owing to its exceptional performance across benchmarks. Moreover, Bloom-560M model (BigScience,  ###reference_b16###) and OPT-125M (Zhang2022,  ###reference_b17###) models were selected based on fewer parameter facilitating deployment on resource-constrained embedded devices, open-source availability, and highest TruthfulQA score(lin2022truthfulqa,  ###reference_b11###) for their parameter range illustrated in Figure. 3.\nWe conducted additional analysis to benchmark our models against those with significantly larger parameter counts, which are specialized for medical datasets. Our analysis reveals that OPT-125M and Bloom-560M, with a small memory footprint, exhibit modest accuracy scores of 27.6%, 29.5%. These models are particularly attractive due to their relatively lower parameter counts, facilitating easier deployment, thereby achieving low-latency performance. Respectively, LLaMa2-7B achieves 51.9% accuracy on these tests, reflecting its efficacy in medical applications. Figure 4 showcasing their potential for deployment in medical applications.\n###figure_4### LangChain (langchain,  ###reference_b18###) plays a crucial role in our model deployment tool-chain through collection of medical databases, optimizing the results through Facebook AI Similarity Search (FAISS) (johnson2019billion,  ###reference_b19###). LangChain efficiently searches a database, to accelerate the retrieval of medical prescription. This streamlined process enhances the overall USMLE score by 2.5 %, facilitating more effective medical knowledge retrieval and utilization.\nTo enhance the domain-specific understanding of our models, we curated a custom dataset detailed in Table 1, from various sources including online medical forums, publicly available biomedical databases, and synthesized real-world clinical case studies enabling our models to grasp medical terminologies effectively. By training our models on this specialized dataset, we enrich their knowledge representation and enhance their performance in medical consultation scenarios. Moreover, we devise an experimental validation setup for our models primarily focusing on the doctor-patient interaction aspect which is lacking in most of the available datasets. In this evaluation, chatGPT4 reviews interactive dialogues for authenticity, response effectiveness, and overall performance, ranking MedAide (LLaMa-2) with a 77% accuracy in comparative analysis.\n###figure_5### To address the above-discussed research challenges, we present our novel MedAide system with the following contributions:\nMedAide system (overview in Figure 5) enables on-premise healthcare diagnosis by learning from domain specific dataset, by automatically collecting, refining and updating samples.\nWe investigated MedAide system with a backbone of three prominent LLM architectures that have demonstrated outstanding performance on the Open-LLM leader-board (Open-LLM-Leaderboard-Report-2023,  ###reference_b10###). Our analysis is centered around benchmarking their performance, with a particular emphasis on their effectiveness in the TruthfulQA task, by mitigating false answers learned from imitating human texts.\nOur proposed MedAide system leverages LLMs with optimizations, enabling seamless deployment on devices such as Nvidia Jetson or consumer-grade GPUs, by identifying hardware constrains through a rigorous model selection criteria for a specific edge device.\nTowards a practical solution, our system integrates LangChain (langchain,  ###reference_b18###) to construct toolchains for effective searching of medical databases for accurate prescription and consultation and medical recommendations.\n###figure_6### Paper Organization: Section 2 discusses state-of-the-art. Section 3 presents the MedAide system in further detail. Section 4 describes the evaluation framework, and results are presented in Section 5. We conclude in Section 6."
        },
        {
            "section_id": "2",
            "parent_section_id": null,
            "section_name": "2. Background and Related Work",
            "text": "LLMs are typically based on transformer architectures (Vaswani2017,  ###reference_b20###) (Wolf2019TransformersSN,  ###reference_b21###), which have become the de facto standard for NLP tasks. Transformers leverage attention mechanisms to proficiently capture contextual and long-range dependencies within textual data (Peters2018DeepCW,  ###reference_b22###), while understanding the chain of discussion. LLMs have made significant contributions in various specialized domains. In healthcare, LLMs have been used for medical diagnosis, clinical decision support, and biomedical text mining. Based on a recent study by Dave et al. (2023) (10.3389/frai.2023.1169595,  ###reference_b4###), it is evident that ChatGPT and even GPT-4 demonstrate comparatively lower performance in vertical domains, particularly in the field of medicine. This can be attributed, in part, to the potential insufficiency of medical knowledge among annotators. Consequently, there are substantial prospects for further investigation and enhancement within this domain.\nEfforts to overcome this limitation and enhance performance in medical domains hold significant promise for advancing the capabilities of language models in healthcare. ChatDoctor (li2023chatdoctor,  ###reference_b23###), an advanced language model based on the LLaMa model (Touvron2023,  ###reference_b24###), is specifically designed for medical assistance. It simulates doctor-patient conversations, enabling patients to receive accurate diagnoses, personalized medical advice, and appropriate treatment options. Luo et al. (Luo2022,  ###reference_b25###) presented BioGPT, a domain-specific generative transformer language model trained on extensive biomedical literature offering generation capabilities tailored specifically for the biomedical domain and achieves superior performance across various biomedical datasets. DrBERT (labrak2023drbert,  ###reference_b26###), a specialized pre-trained language models (PLMs) for the French medical domain, trained on BERT (Devlin2018,  ###reference_b27###) introduced a novel approach by leveraging both left and right context during pre-training, resulting in state-of-the-art performance across various medical tasks. HuatuoGPT (huatuogpt-2023,  ###reference_b28###), a distilled language model for medical consultation, trained using ChatGPT synthesised dialogue and real-world data from doctors, employing RLAIF, achieves state-of-the-art performance in medical consultation. These model have excessive server dependence for deployment, due to high parameter count, constraining the availability on GPUs. Moreover, these LLMs often face a challenge known as ”hallucination,” (hallucination,  ###reference_b29###) where they generate plausible but factually incorrect or nonsensical information. This occurs due to their reliance on patterns in the data they were trained on, without an intrinsic understanding of truth. LangChain integrated with LLMs addresses this issue by structuring interactions with the model in a way that mitigates hallucinations.\nDoctorGLM (xiong2023doctorglm,  ###reference_b30###), trained using ChatGLM-6B (du2022glm,  ###reference_b31###) sets a benchmark on Chinese datasets; however, our work outperforms it with a notable 21% increase in overall accuracy. Han et al. (Han2023,  ###reference_b32###) proposed MedAlpaca addressed the need for open-source models that prioritize patient privacy by developing specialized dataset for medical applications, highlighting the use-case in medical education. However, MedAide outperforms this work by a considerable margin, as demonstrated in our experimental evaluation section."
        },
        {
            "section_id": "3",
            "parent_section_id": null,
            "section_name": "3. MedAide: An LLM-based System for medical assistance",
            "text": "In this section we will describe the MedAide system in detail, along with the dataset generation, refinement and training workflow. We elaborate on LLM quantization and model selection along with LangChain integration (see an overview in Figure 6)."
        },
        {
            "section_id": "3.1",
            "parent_section_id": "3",
            "section_name": "3.1. User Requirements",
            "text": "User requirements, pivotal in designing medical applications, dictate both the user interface design and model selection criteria, ensuring alignment with healthcare professionals’ and patients’ needs. Our analysis highlighted key demands: an intuitive user interface, accurate medical results, secure authentication, and adherence to data privacy laws like HIPAA. Accordingly, we crafted a user interface facilitating secure login and local data storage, overseen by authorized personnel. Additionally, our model selection caters to real-time processing and accuracy modes, tailoring the application to meet these critical user expectations effectively."
        },
        {
            "section_id": "3.2",
            "parent_section_id": "3",
            "section_name": "3.2. Hardware Constraints",
            "text": "There is a trade-off between ensuring high-quality performance and a set of hardware constraints for deployment in consumer-grade GPUs and embedded devices as highlighted in Figure 2. These constraints ensure that LLMs remain within the computational and memory capabilities of the target platforms. The metrics such as storage overhead, based on network parameters, and floating-point operations, quantifying the execution time of the LLMs on GPUs are employed. Given the resource constraints, the trade-off is considering model size for hardware specifications."
        },
        {
            "section_id": "3.4",
            "parent_section_id": "3",
            "section_name": "3.4. Domain Specific Training Methodology",
            "text": "Training LLMs such as LLaMa 2-7B (Touvron2023,  ###reference_b24###) and Bloom-560M (BigScience,  ###reference_b16###) on consumer devices is challenging due to resource limitations. We used Low Rank Adaptation (LoRA) (hu2022lora,  ###reference_b33###) to approximate high-dimensional datasets in lower-dimensional spaces, preserving key features. This technique reduced trainable parameters and GPU memory usage significantly. Bloom-560M, optimized for computational efficiency and accuracy, includes self-attention and feed-forward networks. Similarly, we trained OPT-125M, a model with 12 layers and attention heads, suitable for various hardware configurations used by end-users. Additionally, our approach incorporated Reinforcement Learning from Human Feedback (RLHF) to train a reward model. This model played a pivotal role in refining the training process by providing valuable, human-centric insights. We utilized this reward model to iteratively train a Proximal Policy Optimization (PPO) model, leveraging policy-based rewards. This integration of RLHF allowed for a more nuanced and effective training process, as the PPO model dynamically adjusted its learning strategy based on human feedback. This feedback loop ensured that the model’s outputs not only adhered to technical accuracy but also aligned closely with practical, real-world applicability and user expectations. By embedding human feedback directly into the training cycle, we achieved a more robust and contextually aware LLM, capable of addressing the nuanced demands of medical applications with greater precision. Our implementation followed a structured three-step process as highlighted in Figure 7.\n###figure_7###"
        },
        {
            "section_id": "3.5",
            "parent_section_id": "3",
            "section_name": "3.5. Model Selection and Optimization",
            "text": "Our model selection and optimization process for the LLaMA 2-7B models includes quantization in Q4, Q8, and F16 formats to ensure efficient deployment. Q4 quantization reduces precision to 4 bits, offering smaller model sizes but potentially less accuracy, and is incompatible with Nvidia Jetson boards. Q8 quantization, with 8-bit precision, balances performance and accuracy, while F16 quantization uses 16-bit floating-point representation for complex tasks with reduced size and computational demands. After quantization, the models are calibrated using weight clipping, adjusting weight values to minimize precision loss and maintain performance.\nThe model selection criteria is designed to ensure efficient deployment on the target hardware. We begin by assessing the compatibility of models with the target hardware, particularly noting that NVIDIA boards do not support Q4 models. This ensures that the chosen model is viable for the intended device. We evaluate metrics such as memory usage, inference speed, and the balance between model accuracy and resource consumption. This evaluation is key to identifying the most efficient model within the hardware’s operational constraints. The selection is further refined based on user-defined application requirements, such as the need for real-time processing or a focus on accuracy. This step ensures the model’s alignment with the specific functional demands of the application. Finally, we conduct a comparative analysis of various LLMs, weighing the trade-offs each presents. This comprehensive analysis covers the model’s feasibility on the device and its conformity to user requirements regarding processing speed and accuracy, ensuring a well-rounded selection process.\nIn our comprehensive dataset collection, we leveraged medical databases, e-books, and documents for LangChain (langchain,  ###reference_b18###) integration. To enhance processing efficiency, we segmented this extensive medical knowledge into 1000-character blocks with a 50-character overlap. Leveraging the robust capabilities of Hugging Face Instruct, we generated embeddings for each block, storing them in our local infrastructure with the support of the FAISS library (johnson2019billion,  ###reference_b19###). Notably, we optimized performance by utilizing the GPU-accelerated version of FAISS, resulting in a remarkable speed boost—achieving search speeds 5-10 x faster than the CPU counterpart.\nIn response to a user query, we employ FAISS to identify the two closest neighbors using its similarity search function. These data chunks are then presented as contextual input to our prompt chain, in conjunction with the selected LLMs. We significantly alleviate the common issue of hallucination in LLMs. This approach ensures that the medical guidance provided is not only precise but also grounded in reliable and verified medical content, enhancing the overall safety and dependability of the advice offered."
        },
        {
            "section_id": "4",
            "parent_section_id": null,
            "section_name": "4. Evaluation Setup",
            "text": "The evaluation setup employs a wide range of software and hardware resources for thorough testing and benchmarking. The software environment integrates various tools such as Python 3.10, Cuda 11.8, PyTorch, Lightning, and other essential libraries, along with FAISS for similarity search. Hardware-wise, the setup features diverse Nvidia GPUs, ranging from high-end models like RTX 6000 Ada to embedded solutions like Jetson AGX Xavier, facilitating a comprehensive evaluation of model performance across different computational environments, as indicated in Figure 8.\nThe methodology for evaluation involves deploying models on these hardware platforms to assess key metrics such as accuracy, runtime, and benchmark scores. The USMLE and ChatGPT-4 Scores serve as evaluation metrics described later in Section 5.2, providing a standardized measure of model performance.\n###figure_8###"
        },
        {
            "section_id": "5",
            "parent_section_id": null,
            "section_name": "5. Results",
            "text": ""
        },
        {
            "section_id": "5.1",
            "parent_section_id": "5",
            "section_name": "5.1. Quantitative Analysis of Models",
            "text": "In our research, we performed a quantitative analysis of MedAide models using the USMLE QA dataset, a standard for evaluating LLMs in the medical domiain, depicted in Figure 9, also comparing models’ performance and GPU memory consumption with SOTA LLMs, highlighting the efficiency. Figure 10 complements this by illustrating latency differences across a range of devices, crucial for practical healthcare applications.\n###figure_9### ###figure_10###"
        },
        {
            "section_id": "5.2",
            "parent_section_id": "5",
            "section_name": "5.2. Qualitative Analysis of Models",
            "text": "This model comparison evaluates the performance of different models by examining their responses to 100 single-turn medical questions. Specifically, the comparison focuses on assessing the ratio of model performance for various categories. The evaluation was conducted using chatGPT4 for reviewing and analyzing the models’ outputs, since it scores significantly higher on majority of the benchmarks, considering it as a baseline for performance. The aim of this comparison is to gain insights into how the models perform across various categories and to identify any variations or differences in their effectiveness in health care assessment. Figure 11 presents these findings, and our analysis reveals that our LLaMA 2-7B+FAISS model outperforms MedAlpaca and DoctorGLM by 21% and 13%, respectively. This significant margin underscores the efficacy of the LLaMA 2-7B+FAISS model in the evaluated scenarios.\n###figure_11###"
        },
        {
            "section_id": "6",
            "parent_section_id": null,
            "section_name": "6. Conclusion",
            "text": "This paper presented MedAide, an on-premise medical assistant powered by LLMs. MedAide utilizes specialized medical dataset to provide accurate and reliable healthcare support, including answering medical queries, offering personalized recommendations, and aiding in diagnostics. The results demonstrated the effectiveness of MedAide in various medical domains, showcasing its ability to comprehend complex medical queries, generate informative responses, and assist in clinical decision-making. The results showcase its potential to improve medical workflows, diagnostics, and patient care. Integrating MedAide into real-world healthcare settings holds great promise in enhancing the delivery of healthcare services."
        }
    ]
}