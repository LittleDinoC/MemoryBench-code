{
    "title": "On the True Distribution Approximation of Minimum Bayes-Risk Decoding",
    "abstract": "Minimum Bayes-risk (MBR) decoding has recently gained renewed attention in text generation.\nMBR decoding considers texts sampled from a model as pseudo-references and selects the text with the highest similarity to the others.\nTherefore, sampling is one of the key elements of MBR decoding, and previous studies reported that the performance varies by sampling methods.\nFrom a theoretical standpoint, this performance variation is likely tied to how closely the samples approximate the true distribution of references.\nHowever, this approximation has not been the subject of in-depth study.\nIn this study, we propose using anomaly detection to measure the degree of approximation.\nWe first closely examine the performance variation and then show that previous hypotheses about samples do not correlate well with the variation, but our introduced anomaly scores do.\nThe results are the first to empirically support the link between the performance and the core assumption of MBR decoding.111The code is available at https://github.com/CyberAgentAILab/mbr-anomaly.",
    "sections": [
        {
            "section_id": "1",
            "parent_section_id": null,
            "section_name": "Introduction",
            "text": "Minimum Bayes-risk (MBR) decoding has recently re-emerged as a better alternative to beam search in text generation such as neural machine translation (NMT), text summarization, and image captioning (Eikema and Aziz, 2020  ###reference_b9###; Freitag et al., 2022  ###reference_b14###; Fernandes et al., 2022  ###reference_b11###; Suzgun et al., 2023  ###reference_b34###; Bertsch et al., 2023  ###reference_b4###).\nMBR decoding first samples texts from a model and then selects the text most similar to the others, considering the text samples as substitutes for references.\nTherefore, sampling plays an important role in MBR decoding, and previous studies have reported that the performance varies by sampling methods (Eikema and Aziz, 2020  ###reference_b9###, 2022  ###reference_b10###; Fernandes et al., 2022  ###reference_b11###; Freitag et al., 2023  ###reference_b13###).\nFrom a theoretical standpoint, the samples are assumed to approximate the true distribution, the distribution of human-quality translations (Kumar and Byrne, 2002  ###reference_b23###, 2004  ###reference_b24###).\nIf the approximation deviates, biases can emerge in results of MBR decoding.\nThis implies a significant link between the performance variation and approximation quality.\nAlthough previous studies explained the performance variation by some properties of samples, e.g., sampling bias and cumulative probability mass (Eikema and Aziz, 2020  ###reference_b9###; Freitag et al., 2023  ###reference_b13###), those properties have no clear relation with the true distribution.\nConsequently, the relation between the performance gains by sampling methods and the core assumption remains unclear.\nThis study aims to empirically support the link between the performance and the approximation of true distribution.\nTo this end, we introduce measures for the degree of approximation.\nIf the assumption for samples holds, references, which are drawn from the true distribution by definition, should not deviate from the majority of the samples.\nBased on this recasting, we employ anomaly detection (also called outlier or novelty detection) for the measure.\nOur hypothesis is that references achieve lower anomaly scores among samples obtained with a higher-performance sampling method.\nWe first closely examine the performance variation by sampling methods.\nThen, we show that the variation highly correlates with the anomaly scores but not so with the properties based on previous hypotheses.\nThe results are the first to provide empirical evidence for the link between the performance and core assumption, which is an important step to understanding the connection between the actual performance and the theory of MBR decoding.\n###figure_1###"
        },
        {
            "section_id": "2",
            "parent_section_id": null,
            "section_name": "Preliminaries",
            "text": "Let  be a utility function to measure the quality of model translation  (candidate; Freitag et al., 2022  ###reference_b14###) given its reference translation .\nAmong a set of candidates , MBR decoding selects the one that minimizes the expected error or, equivalently, maximizes the expected utility (Kumar and Byrne, 2002  ###reference_b23###, 2004  ###reference_b24###; Freitag et al., 2022  ###reference_b14###):\nHere,  is the true distribution over translations of an input text  (Kumar and Byrne, 2002  ###reference_b23###, 2004  ###reference_b24###), which describes human-quality translations in the space of all translations.\nSince the true distribution is unknown, MBR decoding approximates Eq. (1  ###reference_###) with finite samples drawn from a model .\nThat is, MBR decoding assumes that the samples drawn from a model approximate the true distribution of references.\nThe samples are called pseudo-references (Freitag et al., 2022  ###reference_b14###), which subsequently serve as alternatives to references in the computation of MBR as follows:\nIn practice, candidates  and pseudo-references  can be the same or different sets of samples.\nFigure 1  ###reference_### shows an example of the above procedure."
        },
        {
            "section_id": "3",
            "parent_section_id": null,
            "section_name": "Performance Variation by Sampling",
            "text": "Previous studies reported that performance varies by sampling methods in NMT.\nHowever, they used the same set of model translations for both candidates and pseudo-references (Eikema and Aziz, 2020  ###reference_b9###; Fernandes et al., 2022  ###reference_b11###; Freitag et al., 2023  ###reference_b13###) or explored sampling methods only for candidates (Eikema and Aziz, 2022  ###reference_b10###).\nThese settings obscure the effect of pseudo-references, for which the true distribution is assumed, on the performance variation.\nThis section shows the effect of pseudo-reference sampling on performance by evaluating pseudo-references separately from candidates.\nSince we focus on sampling for pseudo-references, we first search for the best sampling method for candidates and fix it.\nThe objective of searching for the best is to prevent the pseudo-reference’s contribution to scores from being capped and obscured by the candidate’s quality.\nTo this end, we conduct the search on the same newstest19 as the subsequent experiments.444\nIf the objective is to find the best combination of sampling methods, which is not our focus, then it is desirable to use different splits to explore and test the combination to ensure the generalization.\nNevertheless, our subsequent results in Tables 1  ###reference_###, 2  ###reference_###, 4  ###reference_###, and 5  ###reference_### suggest the generalization of the found best combination as it consistently performs the best across almost all language pairs.\n\nFollowing Fernandes et al. (2022  ###reference_b11###), we search for the sampling method that achieves the highest oracle score, , on average.\nTable 1  ###reference_### shows that epsilon sampling achieves the highest oracle score across the language pairs.\nBased on these results, we fixed the sampling method of candidates to epsilon sampling in all the following experiments.\nThen, we evaluate the effect of pseudo-references on performance by varying their sampling methods.\nTable 2  ###reference_### shows the results.\nAs expected from previous studies, the performance of MBR decoding varies even when only changing the sampling methods of pseudo-references.\nThe variation is nearly consistent across language pairs, indicating the pervasive effect of pseudo-reference on performance.\nThe best sampling method for candidates (epsilon sampling) is not the best for pseudo-references.\nThis shows that the desirable properties for candidates and pseudo-references are different.\nTable 2  ###reference_### also shows the results of beam search just for the comparison with MBR decoding.\nHere, the beam size was set to 5.\nMBR decoding significantly outperforms beam search and even outperforms the ensemble model, which was the winner of WMT19 (Barrault et al., 2019  ###reference_b3###).\nSince the effectiveness of epsilon sampling was reported on the other WMT dataset (Freitag et al., 2023  ###reference_b13###), we have a good reason to use epsilon sampling for this comparison.\nCandidate\nde-en\nen-de\nru-en\nen-ru\n\n\n\nAncestral\n85.82\n86.32\n82.11\n86.13\n\nBeam\n88.47\n89.32\n84.16\n89.44\n\nEpsilon ( = 0.02)\n88.51\n89.47\n84.36\n90.17\n\nNucleus ( = 0.6)\n88.01\n89.12\n83.76\n89.96\n\nNucleus ( = 0.9)\n88.02\n89.04\n83.98\n89.57\nEpsilon ( = 0.02)\n\nPseudo-Reference\nde-en\nen-de\nru-en\nen-ru\n\nAncestral\n85.82\n87.51\n82.02\n88.41\n\nBeam\n85.62\n87.40\n81.64\n87.78\n\nEpsilon ( = 0.02)\n85.89\n87.74\n82.01\n88.46\n\nEpsilon ( = 0.02)∗\n85.87\n87.74\n81.98\n88.46\n\nNucleus ( = 0.6)\n85.69\n87.57\n81.76\n88.26\n\nNucleus ( = 0.9)\n86.04\n87.82\n82.18\n88.61\n\n\nBeam Search\n84.38\n86.13\n80.76\n85.69\n\n\nBeam Search (ensemble)\n84.30\n86.06\n80.91\n85.74"
        },
        {
            "section_id": "3.1",
            "parent_section_id": "3",
            "section_name": "Setup",
            "text": "Following Fernandes et al. (2022  ###reference_b11###), we use publicly-available Transformer models (Vaswani et al., 2017  ###reference_b35###) trained by Ng et al. (2019  ###reference_b27###)222https://github.com/facebookresearch/fairseq/blob/7409af7f9a7b6ddac4cbfe7cafccc715b3c1b21e/examples/translation/README.md  ###reference_q/blob/7409af7f9a7b6ddac4cbfe7cafccc715b3c1b21e/examples/translation/README.md### for the WMT19 news translation task (Barrault et al., 2019  ###reference_b3###).\nThe models were trained in four directions between English (en) and German (de) or Russian (ru).\nWe conducted our experiments on the test set of WMT19 (newstest19), which was used as the development set in the previous work (Fernandes et al., 2022  ###reference_b11###).\nDue to the quadratic computational cost of MBR decoding, we drew 100 samples of  and  for each of the 1,000 examples of newstest19.\nWe employ COMET22 for the utility function , which is the state-of-the-art evaluation metric in machine translation (Rei et al., 2022  ###reference_b28###, 2020  ###reference_b29###).333COMET22 improved robustness to the deviation in numbers and named entities, which was the weakness of the previous COMET (Amrhein and Sennrich, 2022  ###reference_b1###).\nFor sampling methods, we use those that have been reported to be effective: ancestral sampling (Eikema and Aziz, 2020  ###reference_b9###; Freitag et al., 2022  ###reference_b14###), beam search, nucleus sampling (Eikema and Aziz, 2022  ###reference_b10###; Fernandes et al., 2022  ###reference_b11###), and epsilon sampling (Freitag et al., 2023  ###reference_b13###).\nAncestral sampling draws samples from  without modification, while nucleus sampling restricts sampling to words with top- probabilities (Holtzman et al., 2020  ###reference_b18###) and epsilon sampling truncates words with probabilities lower than  (Hewitt et al., 2022  ###reference_b17###).\nWe adopt the best hyperparameters reported for  and  (Fernandes et al., 2022  ###reference_b11###; Freitag et al., 2023  ###reference_b13###).\nThe beam size was set to 100 to collect 100 samples."
        },
        {
            "section_id": "3.2",
            "parent_section_id": "3",
            "section_name": "Results",
            "text": "Since we focus on sampling for pseudo-references, we first search for the best sampling method for candidates and fix it.\nThe objective of searching for the best is to prevent the pseudo-reference’s contribution to scores from being capped and obscured by the candidate’s quality.\nTo this end, we conduct the search on the same newstest19 as the subsequent experiments.444\nIf the objective is to find the best combination of sampling methods, which is not our focus, then it is desirable to use different splits to explore and test the combination to ensure the generalization.\nNevertheless, our subsequent results in Tables 1  ###reference_###  ###reference_###, 2  ###reference_###  ###reference_###, 4  ###reference_###  ###reference_###, and 5  ###reference_###  ###reference_### suggest the generalization of the found best combination as it consistently performs the best across almost all language pairs.\n\nFollowing Fernandes et al. (2022  ###reference_b11###  ###reference_b11###), we search for the sampling method that achieves the highest oracle score, , on average.\nTable 1  ###reference_###  ###reference_### shows that epsilon sampling achieves the highest oracle score across the language pairs.\nBased on these results, we fixed the sampling method of candidates to epsilon sampling in all the following experiments.\nThen, we evaluate the effect of pseudo-references on performance by varying their sampling methods.\nTable 2  ###reference_###  ###reference_### shows the results.\nAs expected from previous studies, the performance of MBR decoding varies even when only changing the sampling methods of pseudo-references.\nThe variation is nearly consistent across language pairs, indicating the pervasive effect of pseudo-reference on performance.\nThe best sampling method for candidates (epsilon sampling) is not the best for pseudo-references.\nThis shows that the desirable properties for candidates and pseudo-references are different.\nTable 2  ###reference_###  ###reference_### also shows the results of beam search just for the comparison with MBR decoding.\nHere, the beam size was set to 5.\nMBR decoding significantly outperforms beam search and even outperforms the ensemble model, which was the winner of WMT19 (Barrault et al., 2019  ###reference_b3###  ###reference_b3###).\nSince the effectiveness of epsilon sampling was reported on the other WMT dataset (Freitag et al., 2023  ###reference_b13###  ###reference_b13###), we have a good reason to use epsilon sampling for this comparison.\nCandidate\nde-en\nen-de\nru-en\nen-ru\n\n\n\nAncestral\n85.82\n86.32\n82.11\n86.13\n\nBeam\n88.47\n89.32\n84.16\n89.44\n\nEpsilon ( = 0.02)\n88.51\n89.47\n84.36\n90.17\n\nNucleus ( = 0.6)\n88.01\n89.12\n83.76\n89.96\n\nNucleus ( = 0.9)\n88.02\n89.04\n83.98\n89.57\nEpsilon ( = 0.02)\n\nPseudo-Reference\nde-en\nen-de\nru-en\nen-ru\n\nAncestral\n85.82\n87.51\n82.02\n88.41\n\nBeam\n85.62\n87.40\n81.64\n87.78\n\nEpsilon ( = 0.02)\n85.89\n87.74\n82.01\n88.46\n\nEpsilon ( = 0.02)∗\n85.87\n87.74\n81.98\n88.46\n\nNucleus ( = 0.6)\n85.69\n87.57\n81.76\n88.26\n\nNucleus ( = 0.9)\n86.04\n87.82\n82.18\n88.61\n\n\nBeam Search\n84.38\n86.13\n80.76\n85.69\n\n\nBeam Search (ensemble)\n84.30\n86.06\n80.91\n85.74"
        },
        {
            "section_id": "4",
            "parent_section_id": null,
            "section_name": "Hypotheses for Performance Variation",
            "text": "The previous section confirmed that the performance varies by sampling pseudo-references.\nThe question that naturally arises in response to the results is: why does this variation occur?"
        },
        {
            "section_id": "4.1",
            "parent_section_id": "4",
            "section_name": "Previous Hypotheses",
            "text": "Eikema and Aziz (2022  ###reference_b10###) hypothesized that unbiased sampling is desirable for pseudo-references.\nSince the biased sampling methods limit the sampling to words of high probability, we use the average log probability (Avg. Prob.) of samples as a continuous proxy of bias existence in sampling.\nEikema and Aziz (2020  ###reference_b9###) and Freitag et al. (2023  ###reference_b13###) did not distinguish between candidates and pseudo-references but referred to the larger cumulative probability mass (Cum. Prob.) of unique samples as a desirable property because it indicates diverse and probable samples.\nEikema and Aziz (2022  ###reference_b10###) employed candidate sampling that achieved high expected utility.\nIf this criterion applies to pseudo-references, performance should be higher when the expected utility against candidates (Cand. Sim.) or references (Ref. Sim.) is high."
        },
        {
            "section_id": "4.2",
            "parent_section_id": "4",
            "section_name": "Our Hypothesis",
            "text": "Given the relaxation from Eq. (1  ###reference_###) to Eq. (2  ###reference_###), a better approximation of the true distribution by pseudo-references should be associated with higher performance.\nTo examine the relation, we propose using anomaly detection to quantitatively evaluate the approximation.\nIf a better approximation is achieved, references should deviate less from the majority of the samples since references are drawn from the true distribution by definition.\nThis recasting allows us to use anomaly scores of anomaly detection for measuring the degree of approximation.\nWe then hypothesize that a higher-performance sampling method forms samples where references achieve lower anomaly scores."
        },
        {
            "section_id": "5",
            "parent_section_id": null,
            "section_name": "Experiments",
            "text": "We test the hypotheses discussed in the previous section by evaluating the correlation between the performance variation and the properties or anomaly scores."
        },
        {
            "section_id": "5.1",
            "parent_section_id": "5",
            "section_name": "Setup",
            "text": "The setup is the same as described in Section 3.1  ###reference_###.\nWe run each sampling method with three different seeds and then calculate the Spearman’s rank correlation coefficient  between their averaged properties or anomaly scores (see Section 4  ###reference_###) with the COMET22 scores reported in Table 2  ###reference_###."
        },
        {
            "section_id": "5.3",
            "parent_section_id": "5",
            "section_name": "Results",
            "text": "Table 3  ###reference_### shows the results.\nAs expected, the anomaly scores are clearly more correlated than the properties based on previous hypotheses.\nExcept for Cum. Prob., Cand. Sim., and Ref. Sim., the signs of  are all as expected, including the anomaly scores.\nSee Table 7  ###reference_### in Appendix for the results used to calculate .\nAmong the anomaly scores,555We took the median of  and  scores instead of the mean because they are unstable due to the inverse covariant matrix  and division, respectively. For , we removed duplicated  from the position vector and added an identity matrix not to drop the rank of  and stabilize the computation of . The value of the elements of the identity matrix was set to 1e-5, taking into account that the average value of the diagonal components of  was 1e-3.  and  with  = 50 stably correlate with the performance variation better than those with  = 100 and .\nWe speculate that the significant degradation of NN with  = 100 is caused by outliers in pseudo-references.\nWhile NN with  < 100 can effectively avoid including these outliers in the calculation of anomaly scores, NN with  = 100 cannot, and its anomaly scores are likely to be distorted by the outliers.\nThese results suggest that even if some pseudo-references are outliers against a reference, the performance tends to be higher if the rest of the pseudo-reference is close to the reference.\nIn other words, pseudo-references do not have to be close to references in entirety to perform well."
        },
        {
            "section_id": "6",
            "parent_section_id": null,
            "section_name": "Related Work",
            "text": "MBR decoding has been used in automatic speech recognition (Goel and Byrne, 2000  ###reference_b15###), statistical machine translation (Kumar and Byrne, 2002  ###reference_b23###, 2004  ###reference_b24###), and NMT (Stahlberg et al., 2017  ###reference_b33###; Shu and Nakayama, 2017  ###reference_b32###; Blain et al., 2017  ###reference_b5###).\nRecently, MBR decoding has gained prominence again in NMT because of the following two innovations.\n(1) Eikema and Aziz (2020  ###reference_b9###) showed that MBR decoding with stochastic sampling has a potential to outperform MAP decoding methods, including beam search; (2) Freitag et al. (2022  ###reference_b14###) and Fernandes et al. (2022  ###reference_b11###) explored utility functions and found that using neural reference-based metrics as the utility function significantly enhances the quality of output texts.\nMüller and Sennrich (2021  ###reference_b26###) reported domain robustness and less hallucination in the outputs of MBR decoding.\nOther text generation tasks such as text summarization, image captioning, and diversity-aware text generation also benefit from MBR decoding (Suzgun et al., 2023  ###reference_b34###; Borgeaud and Emerson, 2020  ###reference_b6###; Jinnai et al., 2024  ###reference_b20###).\nRecent studies have focused on improving the efficiency of MBR decoding (Cheng and Vlachos, 2023  ###reference_b8###; Finkelstein and Freitag, 2023  ###reference_b12###; Yang et al., 2023  ###reference_b36###; Jinnai et al., 2023  ###reference_b21###; Jinnai and Ariu, 2024  ###reference_b19###).\nThe most related studies explored sampling methods for MBR decoding and raised hypotheses to explain the difference in performance by sampling methods (Eikema and Aziz, 2020  ###reference_b9###, 2022  ###reference_b10###; Fernandes et al., 2022  ###reference_b11###; Freitag et al., 2023  ###reference_b13###).\nWe also explored sampling methods but differed in that we did it more closely by focusing on pseudo-references.\nFurthermore, we introduced anomaly scores that correlate with the performance variation better than previous hypotheses."
        },
        {
            "section_id": "7",
            "parent_section_id": null,
            "section_name": "Conclusion",
            "text": "This study investigated the relation between the performance of MBR decoding and the core assumption about samples: samples follow the true distribution of references.\nWe introduced anomaly scores used in anomaly detection to evaluate the approximation of the true distribution.\nExperimental results demonstrated that the anomaly scores correlate with the performance significantly better than the properties hypothesized to explain the performance variation in prior literature.\nThe previous hypotheses assumed that unbiased sampling (Avg. Prob.), diverse and probable samples (Cum. Prob.), or high expected utility (Cand. and Ref. Sim.) are the key properties of samples to achieve high performance.\nHowever, these properties do not have an obvious relationship to approximating the true distribution of references, in contrast to the anomaly scores we employed.\nThese results show the insufficiency of existing hypotheses about the properties that samples should possess.\nThe results are also the first to empirically support the link between the actual performance and the key assumption of MBR decoding.\nWe believe this serves as an essential step to understanding the connection between the actual performance and the theory of MBR decoding."
        },
        {
            "section_id": "8",
            "parent_section_id": null,
            "section_name": "Limitations and Risks",
            "text": "The limitation of the study is that it is solely a thorough analysis of MBR decoding, not accompanied by an algorithm to improve the performance of MBR decoding.\nHowever, our analysis empirically shows that previous hypotheses about the properties of samples are insufficient and that following the assumption of the MBR decoding is the key to improving performance.\nWe believe this is an important contribution that modifies the direction of future development of MBR decoding.\nOur investigation is limited to Transformer models provided by Ng et al. (2019  ###reference_b27###) and the task is limited to machine translation.\nFuture work will extend the analysis to a wider range of models and text generation tasks.\nHowever, it is worth noting that some studies support the general applicability of MBR decoding findings obtained in NMT to other text generation tasks and models.\nSome hyperparameters (Suzgun et al., 2023  ###reference_b34###), efficiency-boosting techniques (Jinnai et al., 2023  ###reference_b21###; Jinnai and Ariu, 2024  ###reference_b19###), or diversity-aware extensions (Jinnai et al., 2024  ###reference_b20###) for MBR decoding consistently perform well across machine translation, summarization, image captioning, and data-to-text generation with different models.\nBertsch et al. (2023  ###reference_b4###) shows that MBR decoding works well even in open-ended text generation tasks.\nWe do not foresee any ethical concerns in our analysis."
        }
    ]
}