{
    "title": "Learn When (not) to Trust Language Models: A Privacy-Centric Adaptive Model-Aware Approach",
    "abstract": "Retrieval-augmented large language models (LLMs) have been remarkably competent in various NLP tasks. Despite their great success, the knowledge provided by the retrieval process is not always useful for improving the model prediction, since in some samples LLMs may already be quite knowledgeable and thus be able to answer the question correctly without retrieval.\nAiming to save the cost of retrieval, previous work has proposed to determine when to do/skip the retrieval in a data-aware manner by analyzing the LLMs’ pretraining data.\nHowever, these data-aware methods pose privacy risks and memory limitations, especially when requiring access to sensitive or extensive pre-training data. Moreover, these methods offer limited adaptability under fine-tuning or continual learning settings.\nWe hypothesize that token embeddings are able to capture the model’s intrinsic knowledge, which offers a safer and more straightforward way to judge the need for retrieval without the privacy risks associated with accessing pre-training data. Moreover, it alleviates the need to retain all the data utilized during model pre-training, necessitating only the upkeep of the token embeddings.\nExtensive experiments and in-depth analyses demonstrate the superiority of our model-aware approach.",
    "sections": [
        {
            "section_id": "1",
            "parent_section_id": null,
            "section_name": "Introduction",
            "text": "Retrieval-augmented large language models (RALMs) excel in various NLP tasks  Li et al. (2022  ###reference_b9###); Yasunaga et al. (2023  ###reference_b18###); Lin et al. (2022  ###reference_b10###); Huang et al. (2024  ###reference_b5###). However, the knowledge provided by the retrieval process is not always useful for improving the LLMs’ prediction, since in some samples LLMs may already be quite knowledgeable and thus be able to answer the question correctly without retrieval. For example, when posed with commonsense questions or queries within the knowledge scope of their pre-training data, LLMs might accurately respond without necessitating retrieval. Moreover, the retrieval process can incur additional computational costs and latency, which could be avoided when the model’s intrinsic knowledge has already been adequate Mallen et al. (2023  ###reference_b11###).\n###figure_1### So motivated, previous work Mallen et al. (2023  ###reference_b11###) has proposed to determine when to do/skip the retrieval in a data-aware manner by analyzing the LLMs’ pretraining data.\nSuch a data-aware approach is developed based on the heuristic that it is easier for LLMs to capture knowledge on entities that are frequently mentioned during pre-training. This adaptive approach can save context length, thereby reducing latency and cost during LLM inference, while also mitigating performance degradation caused by redundant retrievals in LLMs.\nHowever, as shown in Figure 1  ###reference_###, the pre-training data might not always be available due to privacy and commercial constraints Shao et al. (2023  ###reference_b14###); Huang et al. (2022  ###reference_b6###), especially when dealing with proprietary or sensitive datasets.\nThis makes it infeasible to utilize the data-aware approaches in real business scenarios.\nIn addition, the pre-training data are not necessarily aligned with the knowledge learned by LLMs.\nFor example, the pre-training datasets may contain conflicting descriptions regarding the same entity Gu et al. (2023  ###reference_b4###). In such a case, it is uncertain whether the model is knowledgeable about the entity, even if it has been frequently mentioned in the pre-training data.\nIn this paper, we propose a novel model-aware approach to make the judgment about when to do/skip the retrieval.\nInstead of requiring access to the pre-training data, we leverage the pre-trained token embeddings that are believed to explicitly reflect the model’s knowledge.\nIn achieving this, we develop a simple yet effective representation-informed classifier that is capable of recognizing samples that are (not) in need of retrieval.\nThis approach circumvents the risks associated with maintaining pre-training data via only requiring access to the pre-trained token embeddings, offering a safer and more straightforward way to judge the need for retrieval augmentation.\nIn summary, the main contributions of this work are as follows:\nWe identify the privacy constraints inherent in Retrieval-augmented LLMs, and unveil the limitations of the existing data-aware approach.\nWe introduce a novel model-aware approach that decides when to do/skip the retrieval process, by leveraging the token embeddings intrinsic to the model. This approach alleviates the dependency on the accessibility of pretraining data.\nExtensive experiments and in-depth analyses demonstrate the superiority of our model-aware approach compared to the data-aware baseline approach."
        },
        {
            "section_id": "2",
            "parent_section_id": null,
            "section_name": "Model-Aware Adaptive Retrieval Augmentation",
            "text": "In the context of open-domain entity-centric Question Answering (QA), the primary objective of the RALM method is to ascertain whether a given entity requires retrieval augmentation when the QA system is posed with a specific entity-centric question (e.g., ‘Louisiana’ is the entity of the question ‘What is the capital of Louisiana?’). The core of this task is to determine whether language models already possess knowledge of the entity, thereby deciding if there is a need to retrieve external knowledge bases to enhance the model prediction. This adaptive retrieval approach can effectively save context length, thereby reducing latency during LLM inference. Besides, it can mitigate performance degradation caused by redundant retrievals in LLMs Mallen et al. (2023  ###reference_b11###).\nOur rationale for utilizing entity embeddings as an indicator of an LLM’s knowledge about an entity is grounded in extensive prior research.  Gao et al. (2019  ###reference_b3###); Li et al. (2020  ###reference_b8###); Cai et al. (2021  ###reference_b2###) have collectively established a significant correlation between entity embedding distribution and entity frequency in pre-training data across various models, from BERT to the GPT series. Meanwhile,  Mallen et al. (2023  ###reference_b11###) validates the effectiveness of employing the frequency of entities in pretraining data as a criterion for determining the need for retrieval.\nThus, those existent foundational studies informed us that methods leveraging entity embeddings are effective for retrieval augmentation decisions. Then we developed an NN-classifier-based method, aiming to parallel the DM method  Mallen et al. (2023  ###reference_b11###). This classifier aids in determining when an entity requires retrieval augmentation based on its embedding characteristics.\nTo ensure clarity, we define  as the set of entities within the dataset;  as a specific entity, with  denoting its index in set ;  as the tokenized representation of entity  using the GPT/Llama2 tokenizer;  as the first-layer token embedding of the tokenized entity ; C as a neural network classifier;  as the binary outcome (where  indicates the need for retrieval augmentation, and  indicates otherwise).\nGiven an entity  from the set , we tokenize it using the LLM’s tokenizer (e.g., GPT-Neo/Llama2 tokenizer) to obtain its tokenized form, . Subsequently, we extract the first-layer token embedding, , which we hypothesize encapsulates information related to the entity’s frequency.\nIn alignment with previous work Mallen et al. (2023  ###reference_b11###), we curate a subset, denoted as , by randomly sampling the entity-centric data from every sub-relation dataset.\nEach entity  in  is converted to its respective embedding and associated retrieval label (retrieve or not), denoted as  and . These serve as training data for the neural network classifier C.\nAfter the training of the classifier, we employ it to predict the binary outcome  when presented with a new entity . This prediction assists in determining whether the entity  requires retrieval augmentation for open-domain entity-centric QA tasks.\nOur novel model-aware retrieval augmentation method offers an efficient way to determine the need for retrieval augmentation in open-domain entity-centric QA scenarios.\nIn contrast to the data-aware method requiring the availability of the pre-training data, our method focuses on the analysis of entity token embeddings, holding the potential to yield accurate decisions, and ensuring the applicability and scalability in real-world QA systems."
        },
        {
            "section_id": "3",
            "parent_section_id": null,
            "section_name": "Experiments",
            "text": "Following the experiment setting as  Mallen et al. (2023  ###reference_b11###), we choose POPQA, an entity-centric open-domain QA dataset. We have the following research questions (RQs) to guide the experiments:\nRQ1: Given the presence of additional privacy-related constraints, how does the accuracy of our model compare to the state-of-the-art? It’s important to note that while SOTA methods require access to pre-training data, for a fair comparison, we assume that the data-aware methods we compare have access to the frequency of pre-training data.\nRQ2: Regarding the adaptability of our method, when an LLM is fine-tuned, with modified memorization capacity of entities,\ncan our model accurately determine the instances of entity necessitating retrieval?\nFor evaluation, we use accuracy as our primary metric for marking a prediction as correct if any substring of the prediction is an exact match of any of the gold answers. In this section, we will perform an extensive experimental analysis of our model-aware framework."
        },
        {
            "section_id": "4",
            "parent_section_id": null,
            "section_name": "Conclusion",
            "text": "We introduce a novel model-aware approach to tackle challenges in retrieval-augmented LLMs. Leveraging token embeddings that capture the model’s knowledge, we offer an efficient and privacy-conscious solution. Unlike methods dependent on inaccessible or sensitive pretraining data, our approach provides a flexible, scalable, and secure means to assess retrieval requirements. This innovation has broad implications for real-world applications, harmonizing efficiency and privacy while upholding model output quality."
        },
        {
            "section_id": "5",
            "parent_section_id": null,
            "section_name": "Limitations",
            "text": "This work focuses on an entity-centric adaptive retrieval-augmentation technique. It might not work on document-centric QA tasks. We acknowledge the need for future research to explore the extension of our method to a wider range of QA tasks. Besides, how to particularly improve the performance of the retrieval model is beyond the scope of our paper, and has yet to be explored."
        },
        {
            "section_id": "6",
            "parent_section_id": null,
            "section_name": "Ethics Statement",
            "text": "It is important to note that LLMs can still generate incorrect (hallucination) or biased outputs, even when they are retrieval-augmented. Therefore, it is always important to verify the outputs of language models with other sources of information."
        }
    ]
}